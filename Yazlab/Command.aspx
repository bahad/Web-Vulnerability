<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="Command.aspx.cs" Inherits="Yazlab.Command" %>

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>CommandInjection</title>
    <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style type="text/css">
        .auto-style1 {
            width: 100%;
        }
        .auto-style2 {
            width: 151px;
        }
        .auto-style3 {
            width: 801px;
        }
    </style>
</head>
<body>
    <form id="form1" runat="server">
    <div class="container" style="margin-top: 15px">
  <asp:Label ID="Label1" runat="server" Text="ID"></asp:Label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <asp:TextBox ID="TextBox1" runat="server">123456</asp:TextBox> <br />
  <asp:Label ID="Label2" runat="server" Text="Değer"></asp:Label>&nbsp;<asp:TextBox ID="TextBox2" runat="server"></asp:TextBox> <br />
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <div>
            <table class="auto-style1">
                <tr>
                    <td class="auto-style2">
  <asp:Button ID="Button1" runat="server" Text="Button" OnClick="Button1_Click" CssClass="btn-md bg-success" />
                    </td>
                    <td class="auto-style3">
                        <div class="container">
  <!-- Trigger the modal with a button -->
  <button type="button" class="btn btn-info btn-md" data-toggle="modal" data-target="#myModal">Yardım</button>

  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">CommandInjection</h4>
        </div>
        <div class="modal-body">
          <p>Command Injection, yani komut enjeksiyonu saldırganın zafiyet barındıran bir uygulama 
   üzerinden hedef sistemde dilediği komutları çalıştırabilmesine denir. ASP.NET'te,
   kod dosyaları dinamik olarak birbirine eklenmez (PHP'de olduğu gibi). Programcılar yalnızca 
   web.config dosyasında veya bir sayfada denetimler kaydedebilirler. Ancak ASP.NET'te 
   dinamik kod enjeksiyonu hala mümkündür. Amaç, doğrudan yürütüldüğü C # (veya VB.NET, vb.) Kodu eklemektir.
          </p>
            <p style="text-align: center; color: #FF0000">Örnek Kod</p>
            <p>Command açığının gösterilmesi için ilk olarak 2 tane .Net kütpühanesi eklenmelidir.
   <strong>using System.Diagnostics, using System.ComponentModel;</strong> kütüphanelerini ekledikten sonra
   koda bakalım.</p>
   <p><img src="Resim/command.png" /></p>               
            <p>Command.aspx sayfasında id ve textbox değerleri CommandSonuc.aspx sayfasına <strong>GET</strong>
     methoduyla gönderilmektedir.  </p>
   <p><img src="Resim/command2.png" /> </p> 
            <p> Burada saldırganın id değerinin bilmesi gerekiyor.Buraya id değeri koyulmayadabilirdi
   biz id değerini 123456 olarak belirledik. Buradaki <strong>ProcessStartInfo</strong> sınıfı harici 
   kaynaklardan gelen komutların çalıştırılmasını sağlar. Bu sınıf kullanıldığında saldırgan  ayrıca, 
   uygulama dizininize bir kod içeren bir dosya eklemeyi de başarabilir. Bir thread,  başka bir thread
   tarafından yürütülen parçalar da dahil olmak üzere işlem kodunun herhangi bir bölümünü çalıştırabilir.
            </p>
       <p style="color: #FF0000; text-align: center">Örnek Sömürü</p>
            <p><strong>http://localhost:56707/CommandSonuc.aspx?id=123456&psi=cmd.exe</strong> </p>
            <p>Burada örnek olarak bir cmd komutu yazılmıştır. Diğer cmd kodları da aynı şekilde denenebilir
               örnekteki kod cmd ekranını açmaktadır.</p>
          <p style="color: #FF0000; text-align: center">Command Injection dan kaçınma</p>   
            <p>1-)Kontrollerin dinamik olarak yüklenmemesi gerekir.</p>
            <p>2-)ProcessStartInfo ve buna benzer kod çalıştıran diğer sınıflar kullanılmamalıdır.</p> 
            
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
  
</div>
                    </td>
                </tr>
            </table>
        </div>
        <br />
    </div>
    </form>
</body>
</html>
